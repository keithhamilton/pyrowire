<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Receiving Messages &mdash; pyrowire 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="pyrowire 1.0.0 documentation" href="../index.html" />
    <link rel="next" title="Working with Messages" href="working_with_messages.html" />
    <link rel="prev" title="Application Landscape" href="landscape.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="working_with_messages.html" title="Working with Messages"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="landscape.html" title="Application Landscape"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">pyrowire 1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="receiving-messages">
<h1>Receiving Messages<a class="headerlink" href="#receiving-messages" title="Permalink to this headline">¶</a></h1>
<p>pyrowire&#8217;s primary object of note is a message. When an SMS is received by your application, pyrowire will construct a dict from it, using most all available properties provided by the TwiML request body. See <em>Anatomy of a Message</em> for more information message properties.</p>
<div class="section" id="message-endpoints">
<h2>Message Endpoints<a class="headerlink" href="#message-endpoints" title="Permalink to this headline">¶</a></h2>
<p>pyrowire uses a topic-based approach to handling incoming messages. One pyrowire instance can scale to handle
many, many different Twilio SMS applications, and separates logic for each by the use of topics. Each topic is
considered to be a separate Twilio application, has its own definition in your config file, and has the endpoint:</p>
<div class="highlight-python"><div class="highlight"><pre>http(s)://my-rad-pyrowire-instance.mydomain.com/queue/topic
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">topic</span></tt> is a keyword of your choice that identifies messages as being for a specific application.</p>
<p>Because pyrowire handles incoming messages, and can assign workers, on a per-topic basis, you could run as many
different applications off of one cluster as you want, provided you scale up for it. Every time a message is received
via Twilio&#8217;s REST interface, it will be forwarded to your pyrowire instance, queued by its topic, then routed to,
and processed by, a handler specifically designed for that topic/application. Business logic across applications can vary
as much as you need it to, as each topic is handled by a different handler that you define.</p>
</div>
<div class="section" id="message-validation">
<h2>Message Validation<a class="headerlink" href="#message-validation" title="Permalink to this headline">¶</a></h2>
<p>pyrowire has three default message validators. By default, all messages received will be passed through the following:</p>
<ul class="simple">
<li><strong>profanity</strong>: checks the incoming message against a list of about 1,000 graphically profane terms (trust us).</li>
<li><strong>length</strong>: checks that the length of the incoming message does not exceed some threshold; Twilio, by default, uses 160 characters as a limit, so we do too. Also ensures incoming messages have a length &gt; 0.</li>
<li><strong>parseable</strong>: Twilio can&#8217;t parse everything. Take emoji for example. The default parseable validator allows inclusion of all alphanumeric characters and most punctuation characters (the ones people actually use in writing, at any rate).</li>
</ul>
</div>
<div class="section" id="custom-validators">
<h2>Custom Validators<a class="headerlink" href="#custom-validators" title="Permalink to this headline">¶</a></h2>
<p>As described above, pyrowire uses the concept of topics to distinguish handling for each message, but you can also create
custom validators that can be used on messages for one or more topics.</p>
<div class="section" id="defining-a-validator">
<h3>Defining a Validator<a class="headerlink" href="#defining-a-validator" title="Permalink to this headline">¶</a></h3>
<p>Defining a custom validator is easy. Just annotate a method that takes a message, checks to make sure it conforms to some
rule the method identifies, and returns a boolean, and you&#8217;re set.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="nd">@pyrowire.validator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;my_min_length_validator&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">min_length</span><span class="p">(</span><span class="n">message_data</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c"># return True if message is less than 5 chars long</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">message_data</span><span class="p">[</span><span class="s">&#39;message&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">5</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Three things of note when defining a validator:</dt>
<dd><ol class="first last arabic simple">
<li>the <tt class="docutils literal"><span class="pre">pyrowire.validator</span></tt> annotation must take one kwarg, <em>name</em>, and should be used to identify the validator.</li>
<li>the method definition must take one kwarg, <em>message_data</em>, and can be set to default as None</li>
<li>validators must be designed to return True if the message is not valid, <em>i.e., they are trying to prove that the message received is invalid.</em></li>
</ol>
</dd>
</dl>
</div>
<div class="section" id="sample-validator">
<h3>Sample Validator<a class="headerlink" href="#sample-validator" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s check it out by creating, say, a validator that requires the word &#8216;yo&#8217; be present in all messages:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># all app.validator methods need to be annotated with the name of the validator</span>
<span class="c"># and take one kwarg, &#39;message_data&#39;</span>
<span class="nd">@pyrowire.validator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;must_include_yo&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">must_include_yo</span><span class="p">(</span><span class="n">message_data</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">re.search</span>
    <span class="c"># assert that &#39;yo&#39; is not found in the message</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;*yo*&#39;</span><span class="p">,</span> <span class="n">message_data</span><span class="p">[</span><span class="s">&#39;message&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</pre></div>
</div>
<p>By using the <tt class="docutils literal"><span class="pre">&#64;pyrowire.validator</span></tt> annotation, any twilio topics you define in <a class="reference external" href="./settings.html#defining-a-topic">your configuration file</a>
that require the validator &#8216;must_include_yo&#8217; will have to pass this validator in addition to the three defaults. By convention,
the name of the method should match the name passed into the <tt class="docutils literal"><span class="pre">&#64;pyrowire.validator</span></tt> decorator, but it doesn&#8217;t have to.</p>
</div>
<div class="section" id="overriding-default-validators">
<h3>Overriding Default Validators<a class="headerlink" href="#overriding-default-validators" title="Permalink to this headline">¶</a></h3>
<p>Say you don&#8217;t care about profanity. It happens. Say you want to override the default profanity validator, to make it
non-existent...just remove it from your configuration file for the topic in question (see <a class="reference external" href="./tutorial.html#settings">this example</a>).</p>
<p>If you want to change the validator&#8217;s behavior, just define it again:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># profanity validator that considers &#39;reaver&#39; to be the only bad word in the verse</span>
<span class="nd">@pyrowire.validator</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;profanity&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">profanity</span><span class="p">(</span><span class="n">message_data</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">re.search</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;\breaver\b&#39;</span><span class="p">,</span> <span class="n">message_data</span><span class="p">[</span><span class="s">&#39;message&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="related-subjects">
<h3>Related Subjects<a class="headerlink" href="#related-subjects" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="./settings.html#defining-a-topic">Defining a Topic</a></li>
<li><a class="reference external" href="./appendices.html#appendix-c-the-anatomy-of-a-pyrowire-message">Anatomy of a Message</a></li>
</ul>
</div></blockquote>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Receiving Messages</a><ul>
<li><a class="reference internal" href="#message-endpoints">Message Endpoints</a></li>
<li><a class="reference internal" href="#message-validation">Message Validation</a></li>
<li><a class="reference internal" href="#custom-validators">Custom Validators</a><ul>
<li><a class="reference internal" href="#defining-a-validator">Defining a Validator</a></li>
<li><a class="reference internal" href="#sample-validator">Sample Validator</a></li>
<li><a class="reference internal" href="#overriding-default-validators">Overriding Default Validators</a></li>
<li><a class="reference internal" href="#related-subjects">Related Subjects</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="landscape.html"
                        title="previous chapter">Application Landscape</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="working_with_messages.html"
                        title="next chapter">Working with Messages</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/doc_sections/messages.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="working_with_messages.html" title="Working with Messages"
             >next</a> |</li>
        <li class="right" >
          <a href="landscape.html" title="Application Landscape"
             >previous</a> |</li>
        <li><a href="../index.html">pyrowire 1.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Keith Hamilton.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>